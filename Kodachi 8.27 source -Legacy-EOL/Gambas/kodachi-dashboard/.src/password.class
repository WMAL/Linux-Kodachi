' Gambas class file

' #Script written by Warith Al Maawali
' #(c)2021 Founder Of Eagle Eye Digital Solutions
' #Discord channel https: / / discord.gg / KEFErEx
' #Twitter http: / / twitter.com / warith2020
' #Linkedin http: / / www.linkedin.com / In / warith1977
' #http: / / www.digi77.com
' #http: / / www.om77.net
' #Kodachi OS / Software / Code are strictly protected by LICENSE terms at / home / kodachi / LICENSE
' #
' #
' # password.class - Class to manage password operations for Kodachi Dashboard
' # This script provides functions to generate, display, and change passwords.

' Function to handle button 59 click event for generating a short password
Public Sub Button59_Click()

  Dim thePass As String

  ' Execute shell command to generate a short password
  Shell "sudo bash " & globalVars.sFolder & "/gambasexec genPasswordShort" Wait To thePass

  ' Toggle password visibility based on toggle button value
  If ToggleButton9.value = True Then
    MaskBox3.Password = False
  Else
    MaskBox3.Password = True
  End If

  ' Display the generated password in the mask box
  MaskBox3.text = Trim(thePass)
  MaskBox3.SetFocus

End

' Function to handle toggle button 9 click event for toggling password visibility
Public Sub ToggleButton9_Click()

  ' Toggle password visibility based on toggle button value
  If ToggleButton9.value = True Then
    MaskBox3.Password = False
  Else
    MaskBox3.Password = True
  End If

End

' Function to handle button 58 click event for copying password to clipboard
Public Sub Button58_Click()

  ' Copy the password from the mask box to the clipboard
  Clipboard.Copy(MaskBox3.text)

End

' Function to handle button 60 click event for clearing the password
Public Sub Button60_Click()

  ' Clear the password from the mask box
  MaskBox3.Clear

End

' Function to handle button 61 click event for generating a long password
Public Sub Button61_Click()

  Dim thePass As String

  ' Execute shell command to generate a long password
  Shell "sudo bash " & globalVars.sFolder & "/gambasexec genPasswordLong" Wait To thePass

  ' Toggle password visibility based on toggle button value
  If ToggleButton9.value = True Then
    MaskBox3.Password = False
  Else
    MaskBox3.Password = True
  End If

  ' Display the generated password in the mask box
  MaskBox3.text = Trim(thePass)
  MaskBox3.SetFocus

End

' Function to handle button 62 click event for generating a password without symbols
Public Sub Button62_Click()

  Dim thePass As String

  ' Execute shell command to generate a password without symbols
  Shell "sudo bash " & globalVars.sFolder & "/gambasexec genPasswordnosymb" Wait To thePass

  ' Toggle password visibility based on toggle button value
  If ToggleButton9.value = True Then
    MaskBox3.Password = False
  Else
    MaskBox3.Password = True
  End If

  ' Display the generated password in the mask box
  MaskBox3.text = Trim(thePass)
  MaskBox3.SetFocus

End

' Function to handle form open event
Public Sub Form_Open()

  ' Center the form on the screen
  Me.Center

  ' Initialize global variables
  Try globalVars.getGlobalVars()

  ' Display the logged user in the text box
  textbox1.Text = globalVars.loggedUser

  ' Set password fields to masked
  MaskBox1.Password = True
  MaskBox2.Password = True
  MaskBox3.Password = True
  MaskBox4.Password = True

End

' Function to handle toggle button 1 click event for toggling password visibility
Public Sub ToggleButton1_Click()

  ' Toggle password visibility based on toggle button value
  If ToggleButton1.value = True Then
    MaskBox2.Password = False
  Else
    MaskBox2.Password = True
  End If

End

' Function to handle toggle button 2 click event for toggling password visibility
Public Sub ToggleButton2_Click()

  ' Toggle password visibility based on toggle button value
  If ToggleButton2.value = True Then
    MaskBox1.Password = False
  Else
    MaskBox1.Password = True
  End If

End

' Function to handle button 4 click event for copying password to clipboard
Public Sub Button4_Click()

  ' Copy the password from the mask box to the clipboard
  Clipboard.Copy(MaskBox1.text)

End

' Function to handle button 2 click event for copying password to clipboard
Public Sub Button2_Click()

  ' Copy the password from the mask box to the clipboard
  Clipboard.Copy(MaskBox2.text)

End

' Function to handle button 3 click event for clearing the password
Public Sub Button3_Click()

  ' Clear the password from the mask box
  MaskBox2.Clear

End

' Function to handle button 5 click event for clearing the password
Public Sub Button5_Click()

  ' Clear the password from the mask box
  MaskBox1.Clear

End

' Function to handle button 6 click event for copying username to clipboard
Public Sub Button6_Click()

  ' Copy the username from the text box to the clipboard
  Clipboard.Copy(textbox1.text)

End

' Function to handle button 1 click event for changing the password
Public Sub Button1_Click()

  Dim goAhead As Integer = 0
  Dim thePass As String
  Dim thePass1 As String
  Dim thePass2 As String
  Dim theAdress As Integer = Len(TextBox1.text)
  Dim theAdress1 As Integer = Len(MaskBox1.text)
  Dim theAdress2 As Integer = Len(MaskBox2.text)
  Dim theAdress3 As Integer = Len(MaskBox4.text)

  ' Validate username and password fields
  If theAdress > 0 And IsBlank(TextBox1.text) = False  'And isAlphNum == True
    textbox3.text = Format$(Now, "d/m/yy h:nn") & "   " & "Username is ok"
    goAhead = 1

    If theAdress1 > 0 And IsBlank(MaskBox1.text) = False '

      textbox3.text = Format$(Now, "d/m/yy h:nn") & "   " & "Password is ok"
      goAhead = 1

      If theAdress2 > 0 And IsBlank(MaskBox2.text) = False
        goAhead = 1
        textbox3.text = Format$(Now, "d/m/yy h:nn") & "   " & "Password is ok"

        If theAdress3 > 0 And IsBlank(MaskBox3.text) = False
          goAhead = 1
          textbox3.text = Format$(Now, "d/m/yy h:nn") & "   " & "Password is ok"
          If MaskBox2.Text <> MaskBox4.Text Then
            textbox3.text = Format$(Now, "d/m/yy h:nn") & "   " & "New password is not same as confirmation password"
            goAhead = 0
          End If
        Else
          textbox3.text = Format$(Now, "d/m/yy h:nn") & "   " & "Sorry confirmation password is blank"
          goAhead = 0

        End If

      Else
        textbox3.text = Format$(Now, "d/m/yy h:nn") & "   " & "Sorry new password is blank"
        goAhead = 0

      End If
    Else
      textbox3.text = Format$(Now, "d/m/yy h:nn") & "   " & "Sorry existing password is blank"
      MaskBox1.SetFocus
      goAhead = 0
    End If

  Else
    textbox3.text = Format$(Now, "d/m/yy h:nn") & "   " & "username can not be empty"
    textbox1.SetFocus
    goAhead = 0
  End If

  ' If validation is successful, proceed with password change
  If goAhead == 1 Then

    TextBox1.text = Trim(TextBox1.text)
    Shell "sudo bash " & globalVars.sFolder & "/gambasexec passwordChangeCheckUser " & TextBox1.Text Wait To thePass
    thePass = Trim(thePass)
    If thePass == 1 Then
      textbox3.text = Format$(Now, "d/m/yy h:nn") & "   " & "Good username found checking password"
      Shell "sudo bash " & globalVars.sFolder & "/gambasexec passwordChange " & TextBox1.Text & " " & MaskBox1.Text Wait To thePass1
      thePass1 = Trim(thePass1)
      If thePass1 == 1 Then
        textbox3.text = Format$(Now, "d/m/yy h:nn") & "   " & "Password is correct updating new password"
        Shell "sudo bash " & globalVars.sFolder & "/gambasexec passwordChangeAction " & TextBox1.Text & " " & MaskBox2.Text Wait To thePass2
        If thePass1 == 1 Then
          textbox3.text = Format$(Now, "d/m/yy h:nn") & "   " & "Password for " & TextBox1.Text & " changed successfully to " & Left$(MaskBox2.Text) & "***" & Right$(MaskBox2.Text)
        Else
          textbox3.text = Format$(Now, "d/m/yy h:nn") & "   " & "Password change process failed"
        End If
      Else
        textbox3.text = Format$(Now, "d/m/yy h:nn") & "   " & "Sorry existing password is wrong"
      Endif
    Else
      textbox3.text = Format$(Now, "d/m/yy h:nn") & "   " & "username does not exist"
    End If

  End If

End

' Function to handle toggle button 3 click event for toggling password visibility
Public Sub ToggleButton3_Click()

  ' Toggle password visibility based on toggle button value
  If ToggleButton3.value = True Then
    MaskBox4.Password = False
  Else
    MaskBox4.Password = True
  End If

End

' Function to handle button 8 click event for copying password to clipboard
Public Sub Button8_Click()

  ' Copy the password from the mask box to the clipboard
  Clipboard.Copy(MaskBox4.text)

End

' Function to handle button 7 click event for clearing the password
Public Sub Button7_Click()

  ' Clear the password from the mask box
  MaskBox4.Clear

End

' Function to handle button 9 click event for clearing the username
Public Sub Button9_Click()

  ' Clear the username from the text box
  TextBox1.text = ""

End
